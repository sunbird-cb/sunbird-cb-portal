<div class="header-synopsis fixed-width margin-top-xl" [ngClass]="{ 'header-synopsis-gradient': bannerUrl }" *ngIf="show">
  <div class="flex flex-row">
    <div class="flex-auto">
      <div class="header-title flex-col sm:flex-row">
        <!-- image -->
        <div *ngIf="content?.posterImage" class="float-left">
          <img [src]="content?.posterImage | pipePublicURL" [id]="'source_' + content.identifier" class="app-icon"
            [wsUtilsDefaultThumbnail]="defaultSLogo" [alt]="content.sourceName || iGOT" />
        </div>
        <div *ngIf="!content?.posterImage" class="float-left">
          <ng-container *ngIf="content?.appIcon; else defaultImg">
            <img [src]="content?.appIcon | pipePublicURL" [id]="'source_' + content.identifier" class="app-icon"
              [wsUtilsDefaultThumbnail]="defaultSLogo" [alt]="content.sourceName || iGOT" />
          </ng-container>
          <ng-template #defaultImg>
            <img src="/assets/instances/eagle/app_logos/default.png" [id]="'source_' + content.identifier"
              class="app-icon" [alt]="content.sourceName || iGOT" />
          </ng-template>
        </div>
        <div class="sm:ml-5 flex flex-auto" [id]="'m-c-'+ content.identifier">
          <div class="sm:ml-5 flex flex-col flex-auto">
            <h1 class="mat-headline margin-remove-bottom padding-bottom-xs hidden sm:block" [title]="contentReadData?.name">
              {{ contentReadData?.name }}
            </h1>
            <h1 class="mat-headline margin-remove-bottom padding-bottom-xs block sm:hidden" [title]="contentReadData?.name">
              {{ contentReadData?.name }}
            </h1>
            <span *ngIf="contentProgress === 1" class="margin-left-s">
              <mat-icon class="ws-mat-accent-text">check_circle</mat-icon>
            </span>
            <div *ngIf="content?.primaryCategory" class="apIcon float-left mb-4">
              <img src="/assets/icons/content/course.svg" [id]="'source_' + content.identifier"
                class="source-icon" [wsUtilsDefaultThumbnail]="defaultSLogo" [alt]="content.sourceName || iGOT" />
                <span>{{content?.primaryCategory}}</span>
            </div>
            <div *ngIf="content?.appIcon" class="apIcon float-left mb-4">
              <img [src]="content?.creatorLogo | pipePublicURL" [id]="'source_' + content.identifier"
                class="source-icon" [wsUtilsDefaultThumbnail]="defaultSLogo" [alt]="content.sourceName || iGOT" />
            </div>
            <div [ngSwitch]="routePath" class="header-meta" [ngClass]="{ 'header-meta-banner': bannerUrl }">
              <!-- Overview Section -->
              <div class="banner-overview-container" [hidden]="!content?.purpose && showSubtitleOnBanner"
                *ngSwitchCase="'overview'">
                <h3 class="overview-description mat-body-1" *ngIf="showSubtitleOnBanner" i18n-title title="Subtitle">
                  {{ content?.source | pipeLimitTo: 250 }}
                </h3>
                <p class="overview-description mat-body-1" *ngIf="!showSubtitleOnBanner" i18n-title title="Description">
                  {{ content?.instructions | pipeLimitTo: 450 }}
                </p>
                <div *ngIf="sanitizedIntroductoryVideoIcon" class="overview-intro ws-mat-primary-lite-background"
                  [style.backgroundImage]="sanitizedIntroductoryVideoIcon" role="button" (click)="playIntroVideo()">
                  <mat-icon role="button" class="overview-intro-overlay">play_arrow</mat-icon>
                </div>
              </div>
              <!-- Toc Section -->
              <div *ngSwitchCase="'contents'">
                <!-- Contents Banner -->
              </div>
              <!-- Analytics Section -->
              <div class="banner-overview-container mat-body-1" [hidden]="!content?.purpose && showSubtitleOnBanner"
                *ngSwitchCase="'analytics'">
                <h3 class="overview-description mat-body-1" *ngIf="showSubtitleOnBanner" i18n-title title="Subtitle">
                  {{ content?.purpose | pipeLimitTo: 250 }}
                </h3>
                <p class="overview-description mat-body-1" *ngIf="!showSubtitleOnBanner" i18n-title title="Description">
                  {{ content?.instructions | pipeLimitTo: 450 }}
                </p>
                <div *ngIf="sanitizedIntroductoryVideoIcon" class="overview-intro ws-mat-primary-lite-background"
                  [style.backgroundImage]="sanitizedIntroductoryVideoIcon" role="button" (click)="playIntroVideo()">
                  <mat-icon role="button" class="overview-intro-overlay">play_arrow</mat-icon>
                </div>
              </div>
            </div>
            <div *ngIf="content?.averageRating" class="flex items-center rating margin-bottom-m">
              <span class="rating-number mat-body-2">{{ content?.averageRating }}&nbsp;</span>
              <mat-icon class="mat-icon material-icons" *ngFor="let rating of [1, 2, 3, 4, 5]">
                {{ getRatingIcon(rating) }}</mat-icon>
              <span class="margin-left-xs rating-count mat-body-2" *ngIf="content?.totalRating">
                ( {{ content?.totalRating | pipeCountTransform }} )</span>
            </div>
            <div *ngIf="!content?.averageRating" class="flex items-center rating margin-bottom-m">
              <span class="rating-number mat-body-2"> 0.0 &nbsp;</span>
              <mat-icon class="mat-icon material-icons" *ngFor="let rating of [1, 2, 3, 4, 5]">
                {{ getRatingIcon(rating) }}</mat-icon>
              <span class="margin-left-xs rating-count mat-body-2" *ngIf="!content?.totalRating">
                ( {{ 0 | pipeCountTransform }} )</span>
            </div>
            <!-- tags -->
            <div class="tags margin-bottom-s" *ngIf="content?.keywords && content?.keywords?.length > 0">
              <span *ngFor="let tag of content.keywords" class="tag">
                {{tag}}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-container *ngIf="content?.primaryCategory === primaryCategory.BLENDED_PROGRAM">
  <div class="batch-div">
    <form class="flex flex-col gap-4">
      <ng-container *ngIf="batchData && !batchData?.enrolled
        && (!batchData.workFlow?.wfInitiated || (batchData.workFlow?.wfInitiated && batchData?.workFlow?.wfItem?.currentStatus === WFBlendedProgramStatus.REJECTED ||  batchData?.workFlow?.wfItem?.currentStatus === WFBlendedProgramStatus.WITHDRAWN || batchData?.workFlow?.wfItem?.currentStatus === WFBlendedProgramStatus.REMOVED))
        && batchData?.content?.length">
        <mat-form-field appearance="outline" class="w-full batch-form-field">
          <mat-select #batchControlData [formControl]="batchControl" required autoSelctFirstOption (selectionChange)="batchChange($event)" class="batch-dropdown">
            <mat-option *ngFor="let batch of batchData.content; let i=index" [value]="batch" selected="index === 0"
            [disabled]="!handleEnrollmentEndDate(batch) || disableEnrollBtn ">
              <div class="flex flex-row items-center gap-2 h-10">
                <div class="flex-1 text-sm batch-timings">
                    {{ batch.name }} ( {{ batch.startDate | date: 'd MMM, yyyy' }} - {{ batch.endDate | date: 'd MMM, yyyy' || 'present' }} )
                </div>
                <div class="expired" *ngIf="!handleEnrollmentEndDate(batch) || disableEnrollBtn">
                  Expired
                </div>
              </div>
            </mat-option>
          </mat-select>
          <mat-error *ngIf="batchControl.hasError('required')">Please choose a batch to start course</mat-error>
        </mat-form-field>
        <div class="flex flex-wrap gap-3">
          <ng-container *ngIf="!showRejected">
            <div class="flex-1">
              <div class="flex flex-col gap-1" *ngIf="selectedBatch && selectedBatch.enrollmentEndDate ">
                <p class="text-xs leading-4 mb-0">Last enroll date</p>
                <p class="font-bold mb-0">{{ selectedBatch.enrollmentEndDate | date: 'd MMM, y' }}</p>
              </div>
            </div>
            <div class="flex flex-row justify-center items-center">
              <button class="enroll-button" [ngClass]="{ 'disable-btn': disableEnrollBtn || batchControl.hasError('required') || !handleEnrollmentEndDate(selectedBatch) }" [disabled]="disableEnrollBtn || batchControl.hasError('required')|| !handleEnrollmentEndDate(selectedBatch)" (click)="requestToEnrollDialog()">
                <ng-container i18n>
                  Request to enroll
                </ng-container>
              </button>
            </div>
            
          </ng-container>
          <ng-container *ngIf="showRejected">
            <h3 class="margin-remove-bottom mat-body-2 ws-default-text" i18n>
              Your enrollment request is {{batchData?.workFlow?.wfItem?.currentStatus === WFBlendedProgramStatus.REMOVED ?'removed':'rejected'}}.</h3>
          </ng-container>
        </div>
      </ng-container>
    </form>
    <ng-container *ngIf="batchData && !batchData?.enrolled  && batchData?.workFlow?.wfInitiated && 
      (batchData?.workFlow?.wfItem?.currentStatus !== WFBlendedProgramStatus.REJECTED) && (batchData?.workFlow?.wfItem?.currentStatus !== WFBlendedProgramStatus.REMOVED) && 
      (batchData?.workFlow?.wfItem?.currentStatus !== WFBlendedProgramStatus.WITHDRAWN) && 
      (batchData?.workFlow?.wfItem?.currentStatus !== WFBlendedProgramStatus.APPROVED) && batchData?.content?.length">
      <p class="margin-remove-bottom mat-body-1 padding-m bg-white">
        {{batchData?.workFlow?.batch.name}} - ({{batchData?.workFlow?.batch.startDate | date: 'dd-MM-yyyy'}} - {{batchData?.workFlow?.batch.endDate | date: 'dd-MM-yyyy' || 'present'}})
      </p>
      <ng-container>
        <button class="mat-button mat-raised-button withdrawButton  margin-top-s width-1-1 text-white"
          (click)="!disableWithdrawnBtn && requestToWithdrawDialog()" [disabled]="disableWithdrawnBtn" [ngClass]="{ 'disable-btn': disableWithdrawnBtn }" >
            <ng-container i18n> Withdraw your request </ng-container>
        </button>
      </ng-container>
    </ng-container>
    <ng-container *ngIf="batchData && batchData?.enrolled && batchData?.content?.length">
      <h3 class="margin-remove-bottom p-4 bg-white mat-body-1" i18n *ngFor="let batch of batchData.content">
        {{batch.name}} ({{batch.startDate | date: 'dd-MM-yyyy' }} - {{batch.endDate | date: 'dd-MM-yyyy' || 'present'}})
      </h3>
      <ng-container [ngTemplateOutlet]="statusMsg"></ng-container>
    </ng-container>
    <ng-container *ngIf="batchData && !batchData?.enrolled && !batchData?.content?.length">
      <h3 class="margin-remove-bottom mat-body-2 ws-default-text" i18n>
        No batches
      </h3>
    </ng-container>
  </div>
  <ng-container *ngIf="batchData && !batchData?.enrolled && batchData?.content?.length" [ngTemplateOutlet]="statusMsg"></ng-container>
</ng-container>

<!-- <div class="header-synopsis fixed-width margin-top-l" [ngClass]="{ 'header-synopsis-gradient': bannerUrl }" *ngIf="content && batchControl?.value?.batchAttributes?.batchLocationDetails">
  <ng-container *ngIf="content?.primaryCategory === primaryCategory.BLENDED_PROGRAM">
    <h2>Batch location</h2>
    <p>{{batchControl?.value?.batchAttributes?.batchLocationDetails}}</p>
  </ng-container>
</div> -->

<mat-menu #actionMenu="matMenu">
  <div mat-menu-item>
    <ng-container *ngIf="content" [ngTemplateOutlet]="actions"></ng-container>
  </div>
</mat-menu>

<ng-template #actions>
  <a i18n-aria-label aria-label="Take Action" mat-icon-button *ngIf="reviewButton" [routerLink]="['/author/editor/' + content?.identifier]">
    <mat-icon>publish</mat-icon>
  </a>
  <ws-widget-btn-content-download id="prevfordownload" [forPreview]="forPreview" 
    [widgetData]="content | pipePartialContent : ['identifier', 'contentType', 'resourceType', 'mimeType', 'downloadUrl', 'isExternal', 'artifactUrl']">
  </ws-widget-btn-content-download>
  <ws-widget-btn-content-share id="prevforshare" [forPreview]="forPreview" [widgetData]="content">
  </ws-widget-btn-content-share>
  <ws-widget-btn-kb [forPreview]="forPreview" id="prev" [contentId]="content?.identifier" [contentName]="contentReadData?.name"
    [contentType]="content?.contentType" [status]="content?.status">
  </ws-widget-btn-kb>
  <ws-widget-btn-goals [forPreview]="forPreview" id="goalsforprev" *ngIf="isGoalsEnabled && btnGoalsConfig"
    [widgetData]="btnGoalsConfig">
  </ws-widget-btn-goals>
  <ws-widget-btn-playlist [forPreview]="forPreview" id="playlistforprev" *ngIf="btnPlaylistConfig"
    [widgetData]="btnPlaylistConfig">
  </ws-widget-btn-playlist>
  <ws-widget-btn-content-feedback-v2 [forPreview]="forPreview" id="feedbackforprev"
    [widgetData]="content | pipePartialContent: ['identifier', 'name']">
  </ws-widget-btn-content-feedback-v2>
</ng-template>

<ng-template #authView i18n>View</ng-template>

<ng-template #statusMsg>
  <div class="status-container mt-5" *ngIf="content?.primaryCategory === primaryCategory.BLENDED_PROGRAM && batchData?.workFlow?.wfInitiated">
    <div class="flex" *ngIf="showMsg">
      <ng-container *ngIf="showIcon">
        <mat-icon class="mr-3" [ngClass]="iconColor" *ngIf="WFIcon === 'circle'">check_circle</mat-icon>
        <mat-icon class="mr-3 ws-mat-red-text"  style="transform: rotate(180deg);" *ngIf="WFIcon === 'info'">info</mat-icon>
      </ng-container>
      <div class="mat-body-1">
        <p class="margin-remove-bottom ">{{getWFMsg}}</p>
      </div>
    </div>
  </div>
  <div class="status-container mt-5"
    *ngIf="content?.primaryCategory === primaryCategory.BLENDED_PROGRAM && showDisableMsg && !showMsg && findMessage.length > 0">
    <div class="flex">
      <ng-container>
        <mat-icon class="mr-3 ws-mat-red-text"  style="transform: rotate(180deg);">info</mat-icon>
      </ng-container>
      <div class="mat-body-1">
        <p class="margin-remove-bottom ">{{findMessage}}</p>
      </div>
    </div>
  </div>
</ng-template>
