<ng-template #certificateCard>
    <div class="certificate-outer-div">
        <div class="certificate-card">
            <div class="flex flex-col certificate-info p-4 gap-3">
                <div class="flex flex-row">
                    <div class="flex-1">
                        <ng-container *ngIf="skeletonLoader">
                            <ws-widget-skeleton-loader [bindingClass]="'flex rounded'" [width]="'200px'"
                                [height]="'24px'"></ws-widget-skeleton-loader>
                        </ng-container>
                        <ng-container *ngIf="!skeletonLoader">
                            <div class="text-sm font-semibold cursor-pointer">{{ content?.name }}</div>
                            <div class="text-xs font-light">{{ 'apptocsinglepage.completedCourse' | translate }} {{ content?.completedOn ?
                                (content?.completedOn | date: 'd MMM, y') : 'NA' }}</div>
                        </ng-container>
                    </div>
                    <div class="flex justify-center">
                        <ng-container *ngIf="skeletonLoader">
                            <ws-widget-skeleton-loader [bindingClass]="'flex rounded'" [width]="'24px'"
                                [height]="'24px'"></ws-widget-skeleton-loader>
                        </ng-container>
                        <ng-container *ngIf="!skeletonLoader && content?.certificateObj?.certData">
                            <mat-icon class="icon cursor-pointer"
                                (click)="handleOpenCertificateDialog()">arrow_downward</mat-icon>
                        </ng-container>
                    </div>
                </div>
                <div class="flex-1">
                    <ng-container *ngIf="skeletonLoader">
                        <ws-widget-skeleton-loader [bindingClass]="'flex rounded'" [width]="'280px'"
                            [height]="'148px'"></ws-widget-skeleton-loader>
                    </ng-container>
                    <ng-container *ngIf="!skeletonLoader">
                        <div class="certificate_box" *ngIf="!content?.certificateObj?.certData">
                            <img src="/assets/icons/toc/no-certificate.svg" alt="No certificate image" />
                            <div class="flex items-center certificate_overlay">
                                <div class="flex flex-col text-center gap-1 p-4 text-white mt-4">
                                    <div>{{'apptochome.certificationTakesTime' | translate }}</div>
                                    <div>{{'apptochome.issuePersistsMailus' | translate }} mission.karmayogi@gov.in
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ng-container *ngIf="content?.certificateObj?.certData">
                            <img class="ceritificate-image"
                                [src]="content?.certificateObj?.certData | pipeSafeSanitizer: 'url'"
                                alt="certificate image" />
                        </ng-container>
                    </ng-container>
                </div>
            </div>
        </div>
        <div class="flex flex-wrap gap-3 chips-card">
            <ng-container *ngFor="let subTheme of content?.subTheme; let j = index">
                <div class="chip rounded-full p-2 text-xs"
                    [ngClass]="{'hidden': (j > 1 && !content?.viewMore), 'chip-ellipsis': !content?.viewMore && content?.subTheme?.length > 1 }"
                    [title]="subTheme">{{ subTheme }}</div>
            </ng-container>
            <div class="flex items-center text-primary underline cursor-pointer text-xs"
                *ngIf="content?.subTheme?.length > 2 && !content?.viewMore" (click)="content.viewMore = !content.viewMore">
                {{'competencyCardDetails.viewMore' | translate}}
            </div>
            <div class="flex items-center text-primary underline cursor-pointer text-xs" *ngIf="content?.viewMore"
                (click)="content.viewMore = !content.viewMore">{{'competencyCardDetails.viewLess' | translate}}
            </div>
        </div>
    </div>
</ng-template>

<ng-template #competencyLabel>
    <div class="mat-subheading-1 flex items-center gap-2">
        {{ 'apptocsinglepage.competencies' | translate }}
        <mat-icon class="cursor-pointer ws-mat-black60-text info-icon mat-icon notranslate material-icons mat-icon-no-color"
            [matTooltipPosition]="'below'" #tooltip="matTooltip" (click)="tooltip.toggle()" matTooltip="{{ 'apptocsinglepage.competenciesTooltip' | translate }}">info_outline</mat-icon>
    </div>
</ng-template>

<div class="flex flex-col gap-10 my-4 px-4" [class.mt60]="sticky">
    <ng-container *ngIf="content?.completionStatus === 2 || content?.certificateObj?.certData">
        <div class="certificate-container">
            <div class="flex flex-row earned-certificate-container">
                <div class="ribbon"></div>
                <div class="certificate-background">
                    <div class="p-4">
                        <div class="earned-certificate">{{ 'apptocsinglepage.certificateEarned' | translate }}</div>
                    </div>
                    <div class="flex flex-col items-end">
                        <ng-container [ngTemplateOutlet]="certificateCard"></ng-container>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="mobile-certificate-container">
            <div class="earned-certificate-container">
                <div class="flex flex-row">
                    <div class="ribbon"></div>
                    <div class="earned-certificate">{{ 'apptocsinglepage.certificateEarned' | translate }}</div>
                </div>
                <div class="certificate-background">
                    <ng-container [ngTemplateOutlet]="certificateCard"></ng-container>
                </div>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="fromViewer || router.url.includes('/viewer/pdf/do_')">
        <div class="flex flex-col gap-1 mt-2">
            <div class="flex font-semibold text-base">{{ handleCapitalize(content?.name) }} </div>
            <div class="mob-text break-words text-sm">{{ 'cardcontentv2.by' | translate }} {{ content?.source }}</div>
        </div>
    </ng-container>

    <ng-container *ngIf="timer.days >= 0 && content?.primaryCategory === primaryCategory.BLENDED_PROGRAM">
        <div class="flex flex-col gap-6 batch-timer">
            <div class="flex flex-row">
                <div class="flex-1">
                    <div class="flex underline"></div>
                </div>
                <div class="flex">
                    <div class="timer-label">{{ 'apptocsinglepage.batchStartsIn' | translate }}</div>
                </div>
                <div class="flex-1">
                    <div class="flex underline"></div>
                </div>
    
            </div>

            <div class="flex flex-row gap-4 justify-center">
                <div class="flex flex-row gap-1 items-center">
                    <div class="text-4xl leading-10 counter">{{ timer.days || 0 }}</div>
                    <div class="counter-label">{{ 'apptocsinglepage.days' | translate }}</div>
                </div>
                <div class="flex items-center counter-label">
                    :
                </div>
                <div class="flex flex-row gap-1 items-center">
                    <div class="text-4xl leading-10 counter">{{ timer.min === 60 ? timer.hours + 1 : timer.hours }}</div>
                    <div class="counter-label">{{ 'apptocsinglepage.hours' | translate }}</div>
                </div>
                <div class="flex items-center counter-label">
                    :
                </div>
                <div class="flex flex-row gap-1 items-center">
                    <div class="text-4xl leading-10 counter">{{ timer.min === 60 ? 00 : timer.min }}</div>
                    <div class="counter-label">{{ 'apptocsinglepage.minutes' | translate }}</div>
                </div>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="content && content?.primaryCategory === primaryCategory.BLENDED_PROGRAM">
        <div class="flex flex-row gap-3 justify-around hideAbove1200">
            <div class="batch-info">
                <div class="font-base font-bold">{{ selectedBatchData?.content[0]?.batchAttributes?.currentBatchSize || '0' }}
                </div>
                <div class="batch-label">{{ 'apptoc.batchSize' | translate }}</div>
            </div>
            <div class="batch-info">
                <div class="font-base font-bold">{{ selectedBatchData?.userCount?.totalApplied || '0' }}</div>
                <div class="batch-label">{{ 'apptoc.totalApplied' | translate }}</div>
            </div>
            <div class="batch-info">
                <div class="font-base font-bold">{{ selectedBatchData?.userCount?.enrolled || '0' }}</div>
                <div class="batch-label">{{ 'apptoc.totalEnrolled' | translate }}</div>
            </div>
        </div>
    </ng-container>

    <div class="flex flex-col" *ngIf="fromViewer || isMobile">
        <ng-container *ngIf="skeletonLoader">
            <div class="flex flex-row gap-3">
                <ws-widget-skeleton-loader [width]="'60px'" [height]="'60px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'60px'" [height]="'60px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'60px'" [height]="'60px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            </div>
        </ng-container>
        <ng-container *ngIf="!skeletonLoader">
            <ws-widget-toc-kpi-values [content]="content" [tocStructure]="tocStructure"
                [isMobile]="isMobile"></ws-widget-toc-kpi-values>
        </ng-container>
    </div>

    <div class="flex flex-col">
        <ng-container *ngIf="skeletonLoader">
            <ws-widget-skeleton-loader [width]="'80px'" [height]="'16px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            <div class="flex flex-col gap-2 mt-4">
                <ws-widget-skeleton-loader [width]="'80%'" [height]="'16px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'95%'" [height]="'16px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'65%'" [height]="'16px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            </div>
        </ng-container>
        <ng-container *ngIf="!skeletonLoader">
            <div class="mat-subheading-1 font-bold">{{ 'apptocsinglepage.summary' | translate }}</div>
            <div [ngClass]="{'mob-desc-ellipsis': summary.ellipsis && isMobile, 'desc-ellipsis': summary.ellipsis && !isMobile}" #summaryElem>
                <span class="mob-text">{{ handleCapitalize(content?.description) }}</span>
                <div class="ws-mat-default-text font-bold cursor-pointer text-sm" *ngIf="summary.viewLess"
                    (click)="summary.ellipsis = !summary.ellipsis; summary.viewLess = !summary.viewLess">&nbsp;{{ 'apptocsinglepage.viewLess' | translate }}</div>
            </div>
            <div class="ws-mat-default-text font-bold text-sm" *ngIf="summary.ellipsis">
                <span class="cursor-pointer" (click)="summary.ellipsis = !summary.ellipsis; summary.viewLess = !summary.viewLess">{{ 'apptocsinglepage.viewMore' | translate }}</span>
            </div>
        </ng-container>
    </div>

    <div class="flex flex-col">
        <ng-container *ngIf="skeletonLoader">
            <ws-widget-skeleton-loader [width]="'80px'" [height]="'16px'"
                [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            <div class="flex flex-col gap-2 mt-4">
                <ws-widget-skeleton-loader [width]="'80%'" [height]="'16px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'95%'" [height]="'16px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'65%'" [height]="'16px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            </div>
        </ng-container>
        <ng-container *ngIf="!skeletonLoader">
            <div class="mat-subheading-1">{{ 'apptocsinglepage.description' | translate }}</div>
            <div class="desc" [ngClass]="{'mob-desc-ellipsis': description.ellipsis}" #descElem>
                <span [innerHTML]="content?.instructions" class="mob-text"></span>
                <div class="ws-mat-default-text font-bold cursor-pointer text-sm" *ngIf="description.viewLess"
                    (click)="description.ellipsis = !description.ellipsis; description.viewLess = !description.viewLess">&nbsp;{{ 'apptocsinglepage.viewLess' | translate }}</div>
            </div>
            <div class="ws-mat-default-text font-bold text-sm" *ngIf="description.ellipsis">
                <span class="cursor-pointer" (click)="description.ellipsis = !description.ellipsis; description.viewLess = !description.viewLess">{{ 'apptocsinglepage.viewMore' | translate }}</span>
            </div>
        </ng-container>
    </div>

    <ng-container *ngIf="skeletonLoader">
        <div class="flex flex-col gap-3">
            <ws-widget-skeleton-loader [width]="'120px'" [height]="'16px'"
                [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            <div class="flex flex-row gap-3">
                <ng-container *ngFor="let i of [1, 2]">
                    <ws-widget-skeleton-loader [width]="'120px'" [height]="'32px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                </ng-container>
            </div>
            <div class="flex flex-row gap-4">
                <ws-widget-skeleton-loader [width]="'40%'" [height]="'80px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'40%'" [height]="'80px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="!skeletonLoader">
        <ng-container *ngIf="!strip?.loaderWidgets?.length || !competenciesObject">
            <div class="flex flex-col">
                <ng-container [ngTemplateOutlet]="competencyLabel"></ng-container>
                {{ 'apptocsinglepage.noCompetencyFound' | translate }}
            </div>
        </ng-container>
        <ng-container *ngIf="strip?.loaderWidgets?.length > 0">
            <div class="flex flex-col gap-3">
                <ng-container [ngTemplateOutlet]="competencyLabel"></ng-container>
                <div class="flex flex-row gap-3 sm:gap-4 mb-3">
                    <ng-container *ngFor="let item of competenciesObject" >
                        <div class="themes-button" [ngClass]="{'theme-activated': competencySelected === item.key}" (click)="handleShowCompetencies(item, 'selected')">{{ item.key }}</div>
                    </ng-container>
                </div>
                <ng-container *ngFor="let item of competenciesObject">
                    <div *ngIf="item?.key === competencySelected">
                        <ws-utils-horizontal-scroller-v2 [loadStatus]="'done'" [stripConfig]="strip.stripConfig">
                            <ng-container *ngFor="let widget of strip?.loaderWidgets; trackBy: tracker">
                                <ng-container [wsResolverWidget]="widget"></ng-container>
                            </ng-container>
                        </ws-utils-horizontal-scroller-v2>
                    </div>
                </ng-container>
            </div>
        </ng-container>
    </ng-container>

    <div class="flex flex-col">
        <ng-container *ngIf="skeletonLoader">
            <ws-widget-skeleton-loader [width]="'48px'" [height]="'16px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            <div class="flex flex-col gap-2 mt-4">
                <ws-widget-skeleton-loader [width]="'95%'" [height]="'16px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                <ws-widget-skeleton-loader [width]="'100%'" [height]="'16px'" [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
            </div>
        </ng-container>
        <ng-container *ngIf="!skeletonLoader">
            <div class="mat-subheading-1">{{ 'userProfile.tags' | translate }}</div>
            <ng-container *ngIf="content?.keywords?.length">
                <div class="flex flex-wrap gap-2" [ngClass]="{'tags-ellipsis': tagsEllipsis && !viewMoreTags}" #tagsElem>
                    <ng-container *ngFor="let tag of content?.keywords; let i = index">
                        <div class="text-xs mob-text" >{{ handleCapitalize(tag) }}</div>
                        <div class="flex items-center" *ngIf="content?.keywords?.length > (i + 1)">
                            <span class="period"></span>
                        </div>
                    </ng-container>
                </div>
                <div class="flex items-center ws-mat-default-text underline cursor-pointer text-xs" *ngIf="tagsEllipsis && !viewMoreTags" (click)="viewMoreTags = !viewMoreTags">{{ 'apptocsinglepage.viewMore' | translate }}</div>
                <div class="flex items-center ws-mat-default-text underline cursor-pointer text-xs mt-1" *ngIf="viewMoreTags"
                 (click)="viewMoreTags = !viewMoreTags">{{ 'apptocsinglepage.viewLess' | translate }}</div>
            </ng-container>
            <div class="flex flex-wrap gap-2" *ngIf="!content?.keywords?.length">
                {{ 'userProfile.noTags' | translate }}
            </div>
        </ng-container>
    </div>

    <div class="mobile-karma-points">
        <ws-widget-karma-points [btnCategory]="" [condition]="condition" (clickClaimKarmaPoints)="handleClickOfClaim($event)" [data]="kparray">
        </ws-widget-karma-points>
    </div>

    <ng-container *ngIf="skeletonLoader">
        <ws-widget-skeleton-loader [width]="'100%'" [height]="'72px'"
            [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
    </ng-container>
    <ng-container *ngIf="!skeletonLoader">
        <div class="flex flex-col sm:flex-row items-center discussion-div">
            <div class="flex-1 forum-content">
                <div class="flex flex-col sm:flex-row gap-5 items-center">
                    <mat-icon>forum</mat-icon>
                    <div class="suggestion-text">{{ 'apptocsinglepage.anySuggestions' | translate }}</div>
                </div>
            </div>
            <div class="flex-none p-3">
                <button class="action-button" (click)="navigateToDiscussionHub()">{{ 'discuss.startDiscuss' | translate }}</button>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="skeletonLoader">
        <div class="flex flex-col gap-6">
            <div class="flex flex-col gap-4" *ngFor="let i of [1, 2]">
                <ws-widget-skeleton-loader [width]="'72px'" [height]="'20px'"
                    [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
        
                <div class="flex flex-row items-center gap-3">
                    <ws-widget-skeleton-loader [width]="'36px'" [height]="'36px'"
                        [bindingClass]="'rounded-full'"></ws-widget-skeleton-loader>
                    <div class="flex flex-col gap-2">
                        <ws-widget-skeleton-loader [width]="'124px'" [height]="'20px'"
                            [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                        <ws-widget-skeleton-loader [width]="'124px'" [height]="'12px'"
                            [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="!skeletonLoader">
        <div class="flex flex-column gap-3" [ngClass]="{'hideAbove1200': !router.url.includes('/viewer/pdf/do_')}" >
            <div class="text-base font-bold">{{ 'apptocsinglepage.authorsAndCurators' | translate }}</div>
            <div class="flex flex-col gap-4">
                <div class="flex flex-row gap-4 items-center" *ngFor="let author of handleParseJsonData(content?.creatorDetails)">
                    <div class="flex items-center justify-center">
                        <ws-widget-avatar-photo [randomColor]="true" [datalen]="1" [size]="'round-m'"
                            [photoUrl]="author.photo || ''" [name]="author.name">
                        </ws-widget-avatar-photo>
                    </div>
                    <div class="flex flex-col gap-1 justify-center">
                        <div class="font-bold">{{ handleCapitalize(author?.name.toLowerCase(), 'name') }}</div>
                        <div class="text-xs leading-3 mob-text">{{ 'apptocsinglepage.author' | translate }}</div>
                    </div>
                </div>
    
                <div class="flex flex-row gap-4" *ngFor="let creator of handleParseJsonData(content?.creatorContacts)">
                    <div class="flex items-center justify-center">
                        <ws-widget-avatar-photo [randomColor]="true" [datalen]="1" [size]="'round-m'" [photoUrl]="creator.photo || ''"
                            [name]="creator.name">
                        </ws-widget-avatar-photo>
                    </div>
                    <div class="flex flex-col gap-1 justify-center">
                        <div class="font-bold">{{ handleCapitalize(creator?.name.toLowerCase(), 'name') }}</div>
                        <div class="text-xs leading-3 mob-text">{{ 'apptocsinglepage.curator' | translate }}</div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
    
    <ng-container *ngIf="skeletonLoader">
        <ws-widget-skeleton-loader [width]="'100%'" [height]="'400px'"
            [bindingClass]="'rounded'"></ws-widget-skeleton-loader>
    </ng-container>
    <ng-container *ngIf="!skeletonLoader">
        <div class="flex flex-col ratings-div gap-10" id="ratingsDiv">
            <ws-widget-rating-summary [ratingSummary]="ratingSummaryProcessed"></ws-widget-rating-summary>
    
            <div class="flex flex-col gap-3">
                <div class="flex flex-row gap-4">
                    <div class="flex-1 mat-subheading-1" id="reviewContainer">{{ 'apptocsinglepage.topReviews' | translate }}</div>
                    <ng-container *ngIf="ratingSummaryProcessed?.avgRating">
                        <div class="ws-mat-default-text cursor-pointer" (click)="handleOpenReviewModal()">{{ 'msg.showAll' | translate }}</div>
                    </ng-container>
                </div>
                <ng-container *ngIf="topRatingReviews && topRatingReviews?.length">
                    <div class="flex gap-5" [ngClass]="isMobile ? 'horizontal-strip' : 'flex-wrap'">
                        <div class="comment-div" *ngFor="let eachReview of topRatingReviews | slice:0:4; let i = index">
                            <div class="p-4 flex flex-col gap-6">
                                <div class="flex flex-row gap-4">
                                    <div class="flex-1">
                                        <div class="text-left desc-ellipsis">{{ handleCapitalize(eachReview?.review) }}</div>
                                    </div>
                                    <div class="flex flex-row gap-2 rating-start-value">
                                        <mat-icon>star</mat-icon>
                                        <div>{{ eachReview?.rating }}</div>
                                    </div>
                                </div>
                                <div class="flex flex-row gap-2 items-center text-sm">
                                    <ws-widget-avatar-photo [randomColor]="true" [datalen]="1" [size]="'round-m'" [photoUrl]="eachReview?.photo || ''" [name]="eachReview?.firstName"></ws-widget-avatar-photo>
                                    <div class="flex flex-wrap">
                                        <div>{{ handleCapitalize(eachReview?.firstName.toLowerCase(), 'name') }}</div>
                                        <div class="flex items-center mx-2">
                                            <span class="period"></span>
                                        </div>
                                        <div>{{ eachReview?.date | pipeRelativeTime }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <div *ngIf="!topRatingReviews || !topRatingReviews?.length">
                    <div class="flex flex-col text-center items-center justify-center bg-white p-4 rounded-md">
                        <div class="font-base font-bold">{{ 'apptocsinglepage.noReviewsFound' | translate }}</div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>